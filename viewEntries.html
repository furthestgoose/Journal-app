<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal Entries</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="title">JOURNAL APP</div>
            <div class="controls">
                <img class="control-btn minimize-btn" src="./assets/Minimise 3.png" alt="Minimize">
                <img class="control-btn close-btn" src="./assets/Exit 2.png" alt="Close">
            </div>
        </div>
        <div class="main-content">
            <img class="background-img" src="./assets/Background 3.png" alt="Pixel Art Background">
            <div class="menu-heading">Your Journal Entries</div>
            <div id="entries" class="entries-container"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.electron.getEntries()
                .then(entries => {
                    const entriesDiv = document.getElementById('entries');
                    entries.forEach(entry => {
                        const entryDiv = document.createElement('div');
                        entryDiv.classList.add('entry');
                        entryDiv.innerHTML = `
                            <h2>${entry.title}</h2>
                            <p>${entry.content}</p>
                            <button class="edit-btn" data-id="${entry.id}">Edit</button>
                            <button class="delete-btn" data-id="${entry.id}">Delete</button>
                            <div class="edit-form" id="edit-form-${entry.id}">
                                <input type="date" id="edit-date-${entry.id}" value="${entry.date}" required>
                                <input type="text" id="edit-title-${entry.id}" value="${entry.title}" required>
                                <textarea id="edit-content-${entry.id}" required>${entry.content}</textarea>
                                <button class="save-btn" data-id="${entry.id}">Save</button>
                            </div>
                        `;
                        entriesDiv.appendChild(entryDiv);
                    });

                    document.querySelectorAll('.edit-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const id = this.getAttribute('data-id');
                            const editForm = document.getElementById(`edit-form-${id}`);
                            editForm.style.display = 'flex';
                        });
                    });

                    document.querySelectorAll('.save-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const id = this.getAttribute('data-id');
                            const date = document.getElementById(`edit-date-${id}`).value;
                            const title = document.getElementById(`edit-title-${id}`).value;
                            const content = document.getElementById(`edit-content-${id}`).value;
                            window.electron.updateEntry(id, date, title, content)
                                .then(() => {
                                    alert('Entry updated successfully!');
                                    const editForm = document.getElementById(`edit-form-${id}`);
                                    editForm.style.display = 'none';
                                    const entryDiv = document.querySelector(`.entry .edit-btn[data-id="${id}"]`).parentElement;
                                    entryDiv.querySelector('h2').textContent = title;
                                    entryDiv.querySelector('p').textContent = content;
                                })
                                .catch(error => {
                                    console.error('Error updating entry:', error);
                                    alert('Failed to update entry.');
                                });
                        });
                    });

                    document.querySelectorAll('.delete-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const id = this.getAttribute('data-id');
                            window.electron.deleteEntry(id)
                                .then(() => {
                                    alert('Entry deleted successfully!');
                                    this.parentElement.remove();
                                })
                                .catch(error => {
                                    console.error('Error deleting entry:', error);
                                    alert('Failed to delete entry.');
                                });
                        });
                    });
                })
                .catch(error => console.error('Error fetching entries:', error));
        });
    </script>
</body>
</html>